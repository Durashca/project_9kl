<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Регистрация</title>
  <!-- Подключение Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

<div class="alignment">
  <input type="text" id="nameInput" placeholder="Name">
</div>
<div class="alignment">
  <input type="email" id="emailInput" placeholder="Email">
</div>
<div class="alignment">
  <input type="password" id="passwordInput" placeholder="Пароль">
</div>

<div style="max-width: 250px">
  <button onclick="registerUser()">Регистрация</button>
  <button onclick="loginUser()">Вход</button>
  <button onclick="deleteUser()">Удалить</button>
  <button onclick="exitUser()">Выйти</button>
</div>

<a id="text-info">Вы ещё не вошли в аккаунт</a>
<br><br>
<a id="name">Name: </a>
<br>
<a id="progress">Progress: </a>

<style>
  .alignment, button {
    margin-bottom: 10px;
  }
</style>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyApYvBJ_Z6AgypvZ4kDEhA_EodJnTFr8-A",
    authDomain: "project9kl-1bce9.firebaseapp.com",
    databaseURL: "https://project9kl-1bce9-default-rtdb.firebaseio.com",
    projectId: "project9kl-1bce9",
    storageBucket: "project9kl-1bce9.appspot.com",
    messagingSenderId: "807367263615",
    appId: "1:807367263615:web:e0a42155f098998244064a",
    measurementId: "G-6YSQ8ZQQ8K"
  };

  firebase.initializeApp(firebaseConfig);
  let database = firebase.database();

  let infoElem = document.getElementById('text-info');
  let nameElem = document.getElementById('name');
  let progressElem = document.getElementById('progress');

  function registerUser() {
    const name = document.getElementById('nameInput').value;
    const email = document.getElementById('emailInput').value;
    const password = document.getElementById('passwordInput').value;

    let auth = firebase.auth();

    auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
              const userData = {
                name: name,
                progress: 0
              };
              database.ref('users/' + userCredential.user.uid)
                      .set(userData)
                      .then(() => {
                        infoElem.innerText = 'Вы вошли в аккаунт!';
                        nameElem.innerText = 'Name: ' + name;
                        progressElem.innerText = 'Progress: ' + 0;
                        console.log('Данные пользователя успешно сохранены в Realtime Database');
                      })
                      .catch((error) => {
                        console.error('Ошибка при сохранении данных: ', error.message);
                      });
            })
            .catch((error) => {
              console.error('Ошибка при регистрации пользователя: ', error.message);
            });
  }

  function loginUser() {
    const email = document.getElementById('emailInput').value;
    const password = document.getElementById('passwordInput').value;

    let auth = firebase.auth();

    auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
              database.ref('users/' + userCredential.user.uid)
                      .once("value", (snapshot) => {
                        if (snapshot.exists()) {
                          let userData = snapshot.val();
                          infoElem.innerText = 'Вы вошли в аккаунт!';
                          nameElem.innerText = 'Name: ' + userData.name;
                          progressElem.innerText = 'Progress: ' + userData.progress;
                          console.log('Вы успешно вошли в аккаунт');
                        } else {
                          console.error('Пользователь с таким ID не найден');
                        }
                      });
            })
            .catch((error) => {
              console.error('Ошибка при авторизации пользователя: ', error.message);
            });
  }

  function deleteUser() {
    const email = document.getElementById('emailInput').value;
    const password = document.getElementById('passwordInput').value;

    let auth = firebase.auth();

    auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
              userCredential.user.delete()
                      .then(() => {
                        database.ref('users/' + userCredential.user.uid).remove()
                                .then(() => {
                                  infoElem.innerText = 'Вы только что вышли!';
                                  nameElem.innerText = 'Name: ';
                                  progressElem.innerText = 'Progress: ';
                                  console.log('Аккаунт пользователя успешно удален.');
                                })
                                .catch((error) => {
                                  console.error('Ошибка при удалении данных пользователя:', error.message);
                                });
                      })
                      .catch((error) => {
                        console.error('Ошибка при удалении пользователя:', error.message);
                      });
            })
            .catch((error) => {
              console.error('Ошибка при авторизации пользователя:', error.message);
            });
  }

  function exitUser() {
    infoElem.innerText = 'Вы только что вышли!';
    nameElem.innerText = 'Name: ';
    progressElem.innerText = 'Progress: ';
  }
</script>
</body>
</html>